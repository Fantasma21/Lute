<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Lute PvP</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <canvas id="screen" width="800" height="400"></canvas>

  <script src="/socket.io/socket.io.js"></script>

  <!-- IMPORTANTE → agora usamos ES MODULES -->
  <script type="module">
    import { updateState, startRenderLoop } from "./render.js";

    const socket = io();

    const playerName = localStorage.getItem("playerName");
    const roomId = localStorage.getItem("roomId");

    if (!playerName || !roomId) {
      alert("Erro: falta nome ou sala!");
      window.location.href = "index.html";
    }

    // Entrar na sala
    socket.emit("join-room", { playerName, roomId });

    // Sala cheia
    socket.on("room-full", () => {
      alert("A sala já tem 2 jogadores! Escolha outra.");
      window.location.href = "index.html";
    });

    // Recebe estado
    socket.on("room-state", (state) => {
      updateState(state);
    });

    // Movimentação
    document.addEventListener("keydown", (e) => {
      const map = {
        ArrowUp: "up",
        ArrowDown: "down",
        ArrowLeft: "left",
        ArrowRight: "right"
      };

      if (map[e.key]) {
        socket.emit("move", map[e.key]);
      }
    });

    // Inicia renderização
    startRenderLoop();
  </script>
</body>
</html>
